!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.VueNativeSock=t():e.VueNativeSock=t()}(self,(()=>(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}e.r(t),e.d(t,{default:()=>c});const i=new(function(){function e(){o(this,e),this.listeners=new Map}return s(e,[{key:"addListener",value:function(e,t,o){return"function"==typeof t&&(this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push({callback:t,vm:o}),!0)}},{key:"removeListener",value:function(e,t,o){var n,s=this.listeners.get(e);return!!(s&&s.length&&(n=s.reduce((function(e,n,s){return"function"==typeof n.callback&&n.callback===t&&n.vm===o&&(e=s),e}),-1))>-1)&&(s.splice(n,1),this.listeners.set(e,s),!0)}},{key:"emit",value:function(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),n=1;n<t;n++)o[n-1]=arguments[n];var s=this.listeners.get(e);return!(!s||!s.length)&&(s.forEach((function(e){var t;(t=e.callback).call.apply(t,[e.vm].concat(o))})),!0)}}]),e}());var r=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(o(this,e),this.format=n.format&&n.format.toLowerCase(),t.startsWith("//")){var s="https:"===window.location.protocol?"wss":"ws";t="".concat(s,":").concat(t)}this.connectionUrl=t,this.opts=n,this.reconnection=this.opts.reconnection||!1,this.reconnectionAttempts=this.opts.reconnectionAttempts||1/0,this.reconnectionDelay=this.opts.reconnectionDelay||1e3,this.reconnectTimeoutId=0,this.reconnectionCount=0,this.passToStoreHandler=this.opts.passToStoreHandler||!1,this.connect(t,n),n.store&&(this.store=n.store),n.mutations&&(this.mutations=n.mutations),this.onEvent()}return s(e,[{key:"connect",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=o.protocol||"";return this.WebSocket=o.WebSocket||(""===n?new WebSocket(e):new WebSocket(e,n)),"json"===this.format&&("sendObj"in this.WebSocket||(this.WebSocket.sendObj=function(e){return t.WebSocket.send(JSON.stringify(e))})),this.WebSocket}},{key:"reconnect",value:function(){var e=this;this.reconnectionCount<=this.reconnectionAttempts?(this.reconnectionCount++,clearTimeout(this.reconnectTimeoutId),this.reconnectTimeoutId=setTimeout((function(){e.store&&e.passToStore("SOCKET_RECONNECT",e.reconnectionCount),e.connect(e.connectionUrl,e.opts),e.onEvent()}),this.reconnectionDelay)):this.store&&this.passToStore("SOCKET_RECONNECT_ERROR",!0)}},{key:"onEvent",value:function(){var e=this;["onmessage","onclose","onerror","onopen"].forEach((function(t){e.WebSocket[t]=function(o){i.emit(t,o),e.store&&e.passToStore("SOCKET_"+t,o),e.reconnection&&"onopen"===t&&(e.opts.$setInstance(o.currentTarget),e.reconnectionCount=0),e.reconnection&&"onclose"===t&&e.reconnect()}}))}},{key:"passToStore",value:function(e,t){this.passToStoreHandler?this.passToStoreHandler(e,t,this.defaultPassToStore.bind(this)):this.defaultPassToStore(e,t)}},{key:"defaultPassToStore",value:function(e,t){if(e.startsWith("SOCKET_")){var o="commit",n=e.toUpperCase(),s=t;"json"===this.format&&t.data&&((s=JSON.parse(t.data)).mutation?n=[s.namespace||"",s.mutation].filter((function(e){return!!e})).join("/"):s.action&&(o="dispatch",n=[s.namespace||"",s.action].filter((function(e){return!!e})).join("/"))),this.mutations&&(n=this.mutations[n]||n),this.store[o](n,s)}}}]),e}();const c={install:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t&&!o.connectManually)throw new Error("[vue-native-socket] cannot locate connection");var n=null;o.$setInstance=function(t){e.config.globalProperties.$socket=t},o.connectManually?(e.config.globalProperties.$connect=function(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;i.$setInstance=o.$setInstance,n=new r(s,i),e.config.globalProperties.$socket=n.WebSocket},e.config.globalProperties.$disconnect=function(){n&&n.reconnection&&(n.reconnection=!1,clearTimeout(n.reconnectTimeoutId)),e.config.globalProperties.$socket&&(e.config.globalProperties.$socket.close(),delete e.config.globalProperties.$socket)}):(n=new r(t,o),e.config.globalProperties.$socket=n.WebSocket);var s="undefined"!=typeof Proxy&&"function"==typeof Proxy&&/native code/.test(Proxy.toString());e.mixin({created:function(){var t=this,o=this,n=this.$options.sockets;s?(this.$options.sockets=new Proxy({},{set:function(e,t,n){return i.addListener(t,n,o),e[t]=n,!0},deleteProperty:function(e,t){return i.removeListener(t,o.$options.sockets[t],o),delete e.key,!0}}),e.config.globalProperties.sockets=new Proxy({},{set:function(e,t,n){return i.addListener(t,n,o),e[t]=n,!0},deleteProperty:function(e,t){return i.removeListener(t,o.$options.sockets[t],o),delete e.key,!0}}),n&&Object.keys(n).forEach((function(o){t.$options.sockets[o]=n[o],e.config.globalProperties.sockets[o]=n[o]}))):(Object.seal(this.$options.sockets),Object.seal(e.config.globalProperties.sockets),n&&Object.keys(n).forEach((function(e){i.addListener(e,n[e],o)})))},beforeUnmount:function(){var t=this;if(s){var o=this.$options.sockets;o&&Object.keys(o).forEach((function(o){delete t.$options.sockets[o],delete e.config.globalProperties.sockets}))}}})}};return t})()));
//# sourceMappingURL=build.js.map